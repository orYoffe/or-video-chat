<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Video chat</title>
    <script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>

    <!-- update the version number as needed -->
    <!-- <script defer src="/__/firebase/8.0.0/firebase-app.js"></script> -->
    <!-- include only the Firebase features as you need -->
    <!-- <script defer src="/__/firebase/8.0.0/firebase-auth.js"></script> 
    <script defer src="/__/firebase/8.0.0/firebase-database.js"></script>
    <script defer src="/__/firebase/8.0.0/firebase-firestore.js"></script>
    <script defer src="/__/firebase/8.0.0/firebase-functions.js"></script>
    <script defer src="/__/firebase/8.0.0/firebase-messaging.js"></script>
    <script defer src="/__/firebase/8.0.0/firebase-storage.js"></script>
    <script defer src="/__/firebase/8.0.0/firebase-analytics.js"></script>
    <script defer src="/__/firebase/8.0.0/firebase-remote-config.js"></script>
    <script defer src="/__/firebase/8.0.0/firebase-performance.js"></script> -->
    <!-- 
      initialize the SDK after all desired features are loaded, set useEmulator to false
      to avoid connecting the SDK to running emulators.
    -->
    <!-- <script defer src="/__/firebase/init.js?useEmulator=true"></script> -->

    <style media="screen">
      body {
        background-color: #ecf0f1;
        line-height: 1;
        margin: 0;
        padding: 0;
        font-family: "helvetica neue";
      }

      nav {
        background-color: #2b4049;
        height: 50px;
        color: white;
        line-height: 50px;
        padding: 0 20px;
        margin: 0 0 50px 0;
      }

      footer {
        background-color: #d1dadc;
        color: #253841;
        line-height: 50px;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        height: 50px;
        padding: 0 20px;
      }

      footer a {
        color: #56aed4;
        font-size: 16px;
        text-decoration: none;
        transition: all 0.3s ease-in-out;
      }

      footer a:hover {
        color: #375595;
      }

      .video-container {
        background-color: #15252d;
        border-radius: 4px 4px 0 0;
        width: 600px;
        margin: 0 auto;
        position: relative;
      }

      .video-call {
        width: 600px;
        height: 447px;
      }

      .video-self {
        width: 174px;
        height: 130px;
        position: absolute;
        right: 0;
        bottom: 50px;
        background-color: #253841;
        z-index: 10px;
        border-radius: 24px 0 0 0;
      }

      .share {
        background-color: #53b6ee;
        height: 50px;
        padding: 0 15px;
      }

      .share a {
        line-height: 50px;
        color: #375595;
        font-size: 18px;
        text-decoration: none;
        transition: all 0.3s ease-in-out;
        cursor: pointer;
      }

      .share a:hover {
        color: #ea3d3d;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <nav>Video Chat</nav>
      <div class="video-container">
        <video class="video-call" autoplay></video>
        <video class="video-self" autoplay></video>
        <!-- <form id="form">
            <label >
                Name:
                <input type="text" placeholder="John">
            </label>
            <input type="submit" value="Save">
        </form>
        <div class="share">
            <a>Share - {"http://mertkahyaoglu.github.io/video-chat/#"+this.state.hash}</a>
        </div> -->
      </div>
    </div>
    <script>
      var person = prompt("Please enter your name", "Harry Potter");
      // if (person != null) {
      //   document.getElementById("demo").innerHTML =
      //     "Hello " + person + "! How are you today?";
      // }
      // const form = document.getElementById('form');

      // form.onsubmit =

      var id = parseInt(Math.random() * 1e4, 10).toString(16);
      var peer = new Peer(id);
      console.log("------------id------------", id);
      var getUserMedia =
        navigator.getUserMedia ||
        navigator.webkitGetUserMedia ||
        navigator.mozGetUserMedia ||
        navigator.msGetUserMedia;
      getUserMedia(
        { video: true, audio: false },
        function (stream) {
          var video = document.querySelector(".video-self");
          if (typeof video.srcObject == "object") {
            video.srcObject = stream;
          } else {
            video.src = window.URL.createObjectURL(stream);
          }
        },
        function (err) {
          console.log("Failed to get local stream", err);
        }
      );
      function call(peerId) {
        getUserMedia(
          { video: true, audio: true },
          function (stream) {
            var call = peer.call(peerId, stream);
            call.on("stream", function (remoteStream) {
              var video = document.querySelector(".video-call");
              if (typeof video.srcObject == "object") {
                video.srcObject = remoteStream;
              } else {
                video.src = window.URL.createObjectURL(remoteStream);
              }
            });
          },
          function (err) {
            console.log("Failed to get local stream", err);
          }
        );
      }
      // function receiveCall(params) {
      peer.on("call", function (call) {
        getUserMedia(
          { video: true, audio: true },
          function (stream) {
            call.answer(stream); // Answer the call with an A/V stream.
            call.on("stream", function (remoteStream) {
              var video = document.querySelector(".video-call");
              if (typeof video.srcObject == "object") {
                video.srcObject = remoteStream;
              } else {
                video.src = window.URL.createObjectURL(remoteStream);
              }
            });
          },
          function (err) {
            console.log("Failed to get local stream", err);
          }
        );
      });

      const urlParams = new URLSearchParams(window.location.search);
      const callID = urlParams.get("id");
      if (callID) {
        call(callID);
      }
      // }
    </script>
  </body>
</html>
